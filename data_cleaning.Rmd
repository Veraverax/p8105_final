---
title: "Data Cleaning"
output: github_document
---

```{r}
library(tidyverse)
```

Read in wine data.

```{r extract_year_function}
year_extract <- function(string) {
  t <- regmatches(string, regexec("[1-2][9|0][0-9][0-9]", string))
  sapply(t, function(x) {
    if (length(x) > 0) {
      return(as.numeric(x))
    } else {
      return(NA)    
    }
  })
}
```

```{r}
wine_df = 
  read_csv(
  "./wine_data/winemag-data-130k-v2.csv") %>% 
  select(-region_2, -taster_twitter_handle) %>% 
  filter(variety == "Pinot Noir",
         !is.na(region_1)
         ) %>%
  mutate(year = year_extract(title))

### remove region 2, taster twitter and missing values in region 1.

wine_type <- read_csv("./wine_data/winemag-data-130k-v2.csv") %>% 
            group_by(variety) %>% 
            count() %>% 
            arrange(desc(n)) %>% 
            as.tibble()

```

Separate wine types by four major types: white, red, sparkling

https://media.winefolly.com/Different-Types-of-Wine-v2.jpg


Explore the data

```{r}


#wine_df %>% 
#  count(taster_name) 

# 17 tasters, could be one of the x variables

#wine_df %>% 
#  count(region_1) %>% 
#  summarise(mean = mean(n))
### more than 200 distinct regions

#wine_df %>% 
#  count(is.na(region_1))

### 1154 NA regions
```


Questions to address for data cleaning and following analysis 

* how to deal w/ NA values in region

* possible to search for coordinates for the winery

* how to focus on major wine types

* find out frequency of wine notes from description and make visualization - to each type
  ** red
  ** white
  ** rose
  ** sparkling
  ** dessert
  
  ** filter by higher ratings
  

Work breakdown:
1. categorize by major types and subtypes, generate subsets - Vera and Jady
2. figure out the word cloud functions - Yolanda
3. figure out the geo_map searching functions - Helen

```{r geocoding}
wine_tidy_df = 
  read_csv(
  "./wine_data/winemag-data-130k-v2.csv") %>% 
  janitor::clean_names() %>% 
  select(-region_2, -taster_twitter_handle, -taster_name, -x1) %>% 
  mutate(year = year_extract(title)) 

wine_by_country = wine_tidy_df %>% 
  group_by(country) %>% 
  count() %>% 
  arrange(desc(n)) %>% view

wine_us_df = wine_tidy_df %>% 
  filter(country == "US")

wine_ny_df = wine_tidy_df %>% 
  filter(province == "New York") %>% 
  view

```

