---
title: "Data Cleaning"
output: github_document
---

```{r}
library(tidyverse)
library(leaflet)
library(ggplot2)
library(tigris)
library(readxl)
```

Read in wine data.

```{r extract_year_function}
year_extract <- function(string) {
  t <- regmatches(string, regexec("[1][9][4-9][0-9]|[2][0-9][0-9][0-9]", string))
  sapply(t, function(x) {
    if (length(x) > 0) {
      return(as.numeric(x))
    } else {
      return(NA)    
    }
  })
}

```

Read in the wine data and generate year variable and save as csv file.

```{r}
wine_df = 
  read_csv(
  "./wine_data/winemag-data-130k-v2.csv") %>% 
  select(-region_2, -taster_twitter_handle) %>% 
  mutate(year = year_extract(title))


```

Separate wine types by four major types: white, red, sparkling

https://media.winefolly.com/Different-Types-of-Wine-v2.jpg

# Subset data to four types of wine: red, white, sparkling, and rose.
```{r}
wine_type = 
    read_xlsx(
  "./wine_data/wine type.xlsx")  

wine_df = 
  wine_df %>% 
  mutate(type = ifelse(variety %in% wine_type$red, "red", 
                       ifelse(variety %in% wine_type$white, "white", 
                              ifelse(variety %in% wine_type$sparkling, "sparkling", 
                                     ifelse(variety %in% wine_type$rose, "rose", NA )))))

red_df = 
  wine_df %>% 
    filter(!is.na(type),
           type == "red")
  
white_df = 
  wine_df %>% 
    filter(!is.na(type),
           type == "white")

sparkling_df = 
  wine_df %>% 
    filter(!is.na(type),
           type == "sparkling")

rose_df = 
  wine_df %>% 
    filter(!is.na(type),
           type == "rose")
write.csv(wine_df, file = "./wine_data/tidy/wine_all.csv")
write.csv(red_df, file = "./wine_data/tidy/wine_red.csv")
write.csv(white_df, file = "./wine_data/tidy/wine_white.csv")
write.csv(sparkling_df, file = "./wine_data/tidy/wine_sparkling.csv")
write.csv(rose_df, file = "./wine_data/tidy/wine_rose.csv")
```


Questions to address for data cleaning and following analysis 

* how to deal w/ NA values in region

* possible to search for coordinates for the winery

* how to focus on major wine types

* find out frequency of wine notes from description and make visualization - to each type (filter by higher ratings)
  ** red
  ** white
  ** rose
  ** sparkling
  ** dessert

  

Work breakdown:
1. categorize by major types and subtypes, generate subsets - Vera and Jady
2. figure out the word cloud functions - Yolanda
3. figure out the geo_map searching functions - Helen
